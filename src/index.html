<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta
            name="description"
            content="Color Extractor Add-on for Adobe Express"
        />
        <meta name="keywords" content="Adobe, Express, Add-On, JavaScript, Document Sandbox Runtime" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Color Extractor</title>
        <!-- Adobe Spectrum Web Components -->
        <script type="module" src="https://unpkg.com/@spectrum-web-components/bundle/elements.js"></script>
        <link rel="stylesheet" href="https://unpkg.com/@spectrum-web-components/theme/dist/themes/express.css" />
        <style>
            * {
                box-sizing: border-box;
            }

            body {
                margin: 0;
                padding: 0;
                font-family: adobe-clean, 'Source Sans Pro', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }

            .container {
                margin: 24px;
                display: flex;
                flex-direction: column;
                gap: 28px;
                max-width: 100%;
                padding-bottom: 8px;
            }

            .section {
                display: flex;
                flex-direction: column;
                gap: 12px;
            }

            .section-title {
                font-size: 16px;
                font-weight: 700;
                color: var(--spectrum-global-color-gray-900);
                margin: 0;
                letter-spacing: -0.02em;
                text-transform: uppercase;
                font-size: 12px;
                letter-spacing: 0.08em;
                margin-bottom: 4px;
            }

            .helper-text {
                font-size: 13px;
                color: var(--spectrum-global-color-gray-700);
                margin: 0;
                line-height: 1.5;
                font-weight: 500;
            }

            #fileInputWrapper {
                position: relative;
                width: 100%;
                display: flex;
                flex-direction: column;
                gap: 10px;
                cursor: pointer !important;
            }

            /* FIX 1: Completely hide file input and ensure it doesn't capture cursor */
            #imageUpload {
                position: absolute !important;
                opacity: 0 !important;
                width: 0 !important;
                height: 0 !important;
                overflow: hidden !important;
                pointer-events: none !important;
                clip: rect(0, 0, 0, 0) !important;
                cursor: pointer !important;
            }

            /* FIX 1: Ensure the button wrapper and button itself have pointer cursor */
            #filePickerButton {
                cursor: pointer !important;
            }

            #filePickerButton *,
            #filePickerButton::part(root),
            #filePickerButton::part(button) {
                cursor: pointer !important;
            }

            /* FIX 2: Ensure swap button has pointer when enabled */
            #swapButton:not([disabled]):not([aria-disabled="true"]),
            #swapButton:not([disabled]):not([aria-disabled="true"]) *,
            #swapButton:not([disabled]):not([aria-disabled="true"])::part(root),
            #swapButton:not([disabled]):not([aria-disabled="true"])::part(button) {
                cursor: pointer !important;
            }

            /* Spectrum Button Enhancements */
            sp-button {
                width: 100%;
                --spectrum-button-font-weight: 600;
                --spectrum-button-border-radius: 8px;
                transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
                cursor: pointer !important;
            }

            /* FIX 1 & 2: Ensure all enabled buttons have pointer cursor */
            sp-button:not([disabled]):not([aria-disabled="true"]) {
                cursor: pointer !important;
            }

            sp-button:hover:not([disabled]):not([aria-disabled="true"]) {
                transform: translateY(-1px);
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.12);
                cursor: pointer !important;
            }

            sp-button:active:not([disabled]):not([aria-disabled="true"]) {
                transform: translateY(0);
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
                cursor: pointer !important;
            }

            /* FIX 3: Blue Upload Button */
            sp-button[variant="primary"] {
                background: #1473e6 !important;
                color: white !important;
                box-shadow: 0 3px 8px rgba(20, 115, 230, 0.3);
                border-radius: 8px;
                cursor: pointer !important;
            }

            sp-button[variant="primary"]:hover:not([disabled]):not([aria-disabled="true"]) {
                background: #0d66d0 !important;
                box-shadow: 0 5px 12px rgba(20, 115, 230, 0.4);
                cursor: pointer !important;
            }

            sp-button[variant="primary"]:active:not([disabled]):not([aria-disabled="true"]) {
                background: #095aba !important;
                cursor: pointer !important;
            }

            /* FIX 3: Green Swap Colors Button */
            sp-button[variant="accent"] {
                background: #2ecc71 !important;
                color: white !important;
                box-shadow: 0 4px 12px rgba(46, 204, 113, 0.35);
                border-radius: 8px;
                cursor: pointer !important;
            }

            sp-button[variant="accent"]:hover:not([disabled]):not([aria-disabled="true"]) {
                background: #27ae60 !important;
                box-shadow: 0 6px 16px rgba(46, 204, 113, 0.45);
                transform: translateY(-2px) scale(1.02);
                cursor: pointer !important;
            }

            sp-button[variant="accent"]:active:not([disabled]):not([aria-disabled="true"]) {
                background: #229954 !important;
                cursor: pointer !important;
            }

            sp-button[variant="secondary"] {
                background: white;
                border: 2px solid var(--spectrum-global-color-gray-300);
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.06);
                cursor: pointer !important;
            }

            sp-button[variant="secondary"]:hover:not([disabled]):not([aria-disabled="true"]) {
                background: var(--spectrum-global-color-gray-50);
                border-color: var(--spectrum-global-color-gray-400);
                box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
                cursor: pointer !important;
            }

            /* FIX 2: Only apply disabled cursor when actually disabled */
            sp-button[disabled],
            sp-button[aria-disabled="true"] {
                opacity: 0.45;
                cursor: not-allowed !important;
                transform: none !important;
                box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05) !important;
            }

            /* Ensure enabled buttons never show disabled cursor */
            sp-button:not([disabled]):not([aria-disabled="true"]) {
                cursor: pointer !important;
            }

            /* Color Palette Styling */
            #colorBar {
                width: 100%;
                height: 85px;
                display: flex;
                border-radius: 12px;
                overflow: visible;
                border: 2px solid var(--spectrum-global-color-gray-200);
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08),
                            inset 0 1px 2px rgba(255, 255, 255, 0.9);
                gap: 4px;
                padding: 4px;
                background: linear-gradient(to bottom, 
                    var(--spectrum-global-color-gray-100),
                    var(--spectrum-global-color-gray-75));
            }

            .color-segment {
                height: calc(100% - 8px);
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-size: 12px;
                font-weight: 700;
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.7),
                             0 0 8px rgba(0, 0, 0, 0.3);
                transition: all 0.18s cubic-bezier(0.4, 0, 0.2, 1);
                cursor: pointer;
                position: relative;
                border-radius: 10px;
                overflow: hidden;
                min-width: 65px;
                border: 2px solid transparent;
                box-shadow: 0 2px 6px rgba(0, 0, 0, 0.25),
                            inset 0 1px 2px rgba(255, 255, 255, 0.1);
            }

            .color-segment::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: linear-gradient(135deg, 
                    rgba(255, 255, 255, 0.2) 0%,
                    transparent 50%,
                    rgba(0, 0, 0, 0.1) 100%);
                opacity: 0;
                transition: opacity 0.3s;
            }

            .color-segment:hover::before {
                opacity: 1;
            }

            .color-segment:hover {
                transform: translateY(-4px) scale(1.04);
                box-shadow: 0 8px 20px rgba(0, 0, 0, 0.35),
                            0 0 0 2px rgba(255, 255, 255, 0.3);
                z-index: 2;
                border-color: rgba(255, 255, 255, 0.6);
            }

            .color-segment.selected {
                border: 3px solid var(--spectrum-global-color-blue-600);
                outline: 3px solid var(--spectrum-global-color-blue-400);
                outline-offset: 3px;
                transform: translateY(-4px) scale(1.05);
                box-shadow: 0 10px 28px rgba(20, 115, 230, 0.5),
                            0 0 0 6px rgba(20, 115, 230, 0.15),
                            0 0 20px rgba(20, 115, 230, 0.3);
                z-index: 3;
                transition: all 0.18s cubic-bezier(0.4, 0, 0.2, 1);
            }

            .color-segment-content {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                gap: 2px;
            }

            .color-segment-percentage {
                font-size: 12px;
                font-weight: 700;
            }

            .color-segment-hex {
                font-size: 9px;
                font-weight: 600;
                opacity: 0.85;
                letter-spacing: 0.5px;
            }

            @keyframes selectedPulse {
                0%, 100% {
                    box-shadow: 0 10px 28px rgba(20, 115, 230, 0.5),
                                0 0 0 6px rgba(20, 115, 230, 0.15),
                                0 0 20px rgba(20, 115, 230, 0.3);
                }
                50% {
                    box-shadow: 0 10px 28px rgba(20, 115, 230, 0.6),
                                0 0 0 8px rgba(20, 115, 230, 0.2),
                                0 0 25px rgba(20, 115, 230, 0.4);
                }
            }

            .color-label {
                position: absolute;
                top: 8px;
                left: 8px;
                right: 8px;
                background: linear-gradient(135deg, 
                    rgba(20, 115, 230, 0.95), 
                    rgba(20, 115, 230, 0.85));
                backdrop-filter: blur(12px) saturate(180%);
                color: white;
                font-size: 11px;
                font-weight: 800;
                padding: 5px 10px;
                border-radius: 8px;
                text-align: center;
                text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
                pointer-events: none;
                opacity: 0;
                transform: translateY(-10px) scale(0.85);
                transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
                box-shadow: 0 4px 12px rgba(20, 115, 230, 0.5),
                            0 0 0 2px rgba(255, 255, 255, 0.3),
                            inset 0 1px 2px rgba(255, 255, 255, 0.2);
                letter-spacing: 0.8px;
                border: 1px solid rgba(255, 255, 255, 0.2);
            }

            .color-segment.selected .color-label {
                opacity: 1;
                transform: translateY(0) scale(1);
            }

            /* Swap Section Styling */
            .swap-section {
                display: flex;
                flex-direction: column;
                gap: 18px;
                padding: 24px;
                background: linear-gradient(135deg, 
                    var(--spectrum-global-color-gray-50) 0%,
                    var(--spectrum-global-color-gray-75) 50%,
                    var(--spectrum-global-color-gray-50) 100%);
                border-radius: 14px;
                border: 2px solid var(--spectrum-global-color-gray-200);
                box-shadow: inset 0 2px 4px rgba(255, 255, 255, 0.9),
                            0 4px 12px rgba(0, 0, 0, 0.08),
                            0 0 0 1px rgba(0, 0, 0, 0.03);
                position: relative;
            }

            .swap-section::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 3px;
                background: linear-gradient(90deg, 
                    var(--spectrum-global-color-blue-500),
                    var(--spectrum-global-color-purple-500),
                    var(--spectrum-global-color-blue-500));
                border-radius: 14px 14px 0 0;
                opacity: 0.6;
            }

            .swap-preview-container {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 20px;
                padding: 16px 0;
            }

            .swap-preview-box {
                width: 110px;
                height: 110px;
                border-radius: 14px;
                border: 3px solid var(--spectrum-global-color-gray-300);
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: flex-end;
                background: white;
                transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
                position: relative;
                overflow: hidden;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12),
                            inset 0 1px 2px rgba(255, 255, 255, 0.9);
            }

            .swap-preview-box.has-color {
                border-color: var(--spectrum-global-color-blue-600);
                box-shadow: 0 6px 20px rgba(20, 115, 230, 0.4),
                            0 0 0 4px rgba(20, 115, 230, 0.15),
                            0 0 15px rgba(20, 115, 230, 0.3),
                            inset 0 1px 2px rgba(255, 255, 255, 0.9);
                transform: scale(1.08);
                animation: previewGlow 3s ease-in-out infinite;
            }

            @keyframes previewGlow {
                0%, 100% {
                    box-shadow: 0 6px 20px rgba(20, 115, 230, 0.4),
                                0 0 0 4px rgba(20, 115, 230, 0.15),
                                0 0 15px rgba(20, 115, 230, 0.3),
                                inset 0 1px 2px rgba(255, 255, 255, 0.9);
                }
                50% {
                    box-shadow: 0 6px 20px rgba(20, 115, 230, 0.5),
                                0 0 0 5px rgba(20, 115, 230, 0.2),
                                0 0 20px rgba(20, 115, 230, 0.4),
                                inset 0 1px 2px rgba(255, 255, 255, 0.9);
                }
            }

            .swap-preview-color {
                width: 100%;
                height: calc(100% - 24px);
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                gap: 4px;
                color: white;
                font-size: 9px;
                font-weight: 700;
                text-shadow: 0 1px 3px rgba(0, 0, 0, 0.6);
                padding: 8px 4px;
                text-align: center;
            }

            .swap-preview-hex {
                font-size: 11px;
                font-weight: 800;
                letter-spacing: 0.5px;
                opacity: 0.95;
            }

            .swap-preview-percentage {
                font-size: 10px;
                font-weight: 600;
                opacity: 0.9;
            }

            .swap-preview-placeholder {
                color: var(--spectrum-global-color-gray-500);
                font-size: 11px;
                font-weight: 600;
                padding: 8px;
                text-align: center;
            }

            .swap-preview-label {
                position: absolute;
                bottom: 0;
                left: 0;
                right: 0;
                background: linear-gradient(to top, rgba(0, 0, 0, 0.85), rgba(0, 0, 0, 0.75));
                color: white;
                font-size: 11px;
                font-weight: 700;
                padding: 6px;
                text-align: center;
                letter-spacing: 0.5px;
            }

            .swap-arrow {
                font-size: 36px;
                color: var(--spectrum-global-color-gray-500);
                transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
                font-weight: bold;
                line-height: 1;
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }

            .swap-preview-container.has-colors .swap-arrow {
                color: var(--spectrum-global-color-blue-600);
                transform: scale(1.3) rotate(5deg);
                filter: drop-shadow(0 3px 8px rgba(20, 115, 230, 0.4));
                animation: arrowPulse 2s ease-in-out infinite;
            }

            @keyframes arrowPulse {
                0%, 100% {
                    transform: scale(1.3) rotate(5deg);
                }
                50% {
                    transform: scale(1.35) rotate(-5deg);
                }
            }

            .swap-helper-text {
                font-size: 12px;
                color: var(--spectrum-global-color-gray-600);
                text-align: center;
                margin-top: 6px;
                transition: all 0.3s;
                font-weight: 500;
                line-height: 1.5;
                padding: 0 8px;
            }

            .swap-button-wrapper {
                display: flex;
                flex-direction: column;
                gap: 8px;
            }

            .swap-success-message {
                font-size: 12px;
                color: #2ecc71;
                text-align: center;
                margin-top: 4px;
                font-weight: 600;
                opacity: 0;
                transform: translateY(-4px);
                transition: all 0.2s ease;
                pointer-events: none;
            }

            .swap-success-message.show {
                opacity: 1;
                transform: translateY(0);
            }

            #swapButton {
                width: 100%;
            }

            #imagePreview {
                border-radius: 12px;
                box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15),
                            0 0 0 1px rgba(0, 0, 0, 0.05);
                border: 2px solid var(--spectrum-global-color-gray-200);
                max-width: 100%;
                height: auto;
                transition: all 0.3s ease;
            }

            #imagePreview:hover {
                box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2),
                            0 0 0 1px rgba(0, 0, 0, 0.08);
                transform: translateY(-2px);
            }

            /* Ensure no default browser styling */
            input[type="file"] {
                display: none !important;
                cursor: pointer !important;
            }

            button {
                appearance: none;
                -webkit-appearance: none;
                -moz-appearance: none;
                cursor: pointer;
            }

            /* FIX 1: Ensure all clickable elements show pointer */
            #filePickerButton,
            #importButton,
            #swapButton:not([disabled]):not([aria-disabled="true"]) {
                cursor: pointer !important;
            }

            /* FIX 2: Prevent disabled cursor on enabled swap button */
            #swapButton:not([disabled]):not([aria-disabled="true"]) {
                cursor: pointer !important;
            }
        </style>
    </head>
    <body>
        <sp-theme system="express" color="light" scale="medium">
            <div class="container">
                <!-- Upload Section -->
                <div class="section">
                    <sp-field-label for="filePickerButton">Upload Image</sp-field-label>
                    <p class="helper-text">Upload an image to extract its dominant colors</p>
                    <div id="fileInputWrapper">
                        <input type="file" id="imageUpload" accept="image/*" />
                        <sp-button id="filePickerButton" variant="primary" style="width: 100%">
                            Upload Image
                        </sp-button>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 6px;">
                        <sp-button id="importButton" variant="secondary" style="width: 100%; margin-top: 8px;" disabled>
                            Import to Document
                        </sp-button>
                        <p class="helper-text" id="importHelperText" style="margin-top: -4px; font-size: 11px;">Upload an image to enable import</p>
                    </div>
                </div>

                <!-- Color Palette Section -->
                <div class="section">
                    <h3 class="section-title">Dominant Colors</h3>
                    <div id="colorBar"></div>
                </div>

                <!-- Swap Section -->
                <div class="swap-section">
                    <h3 class="section-title" style="margin: 0;">Swap Colors</h3>
                    <div class="swap-preview-container" id="swapPreviewContainer">
                        <div class="swap-preview-box" id="color1Preview">
                            <div class="swap-preview-label">Color 1</div>
                            <div class="swap-preview-placeholder" style="color: var(--spectrum-global-color-gray-500); font-size: 10px; padding: 8px;">Select</div>
                        </div>
                        <div class="swap-arrow">â†”</div>
                        <div class="swap-preview-box" id="color2Preview">
                            <div class="swap-preview-label">Color 2</div>
                            <div class="swap-preview-placeholder" style="color: var(--spectrum-global-color-gray-500); font-size: 10px; padding: 8px;">Select</div>
                        </div>
                    </div>
                    <div class="swap-button-wrapper">
                        <sp-button id="swapButton" variant="accent" disabled>Swap Colors</sp-button>
                        <p class="swap-helper-text" id="swapHelperText">Select two colors to enable swapping</p>
                        <p class="swap-success-message" id="swapSuccessMessage">Colors swapped successfully</p>
                    </div>
                </div>
            </div>
        </sp-theme>
        <script type="module" src="add-on-console-override.js"></script>
        <script type="module" src="ui/index.js"></script>
    </body>
</html>
